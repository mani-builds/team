<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="../../../img/logo/neighborhood/favicon.png">
    <title>Meetup Integration & Member Form Config - PartnerTools</title>

    <link rel="stylesheet" href="../../../css/common.css">
    <link rel="stylesheet" href="../../../css/shared-styles.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css">
    
    <!-- Standalone Navigation -->
    <link rel="stylesheet" href="../../../css/standalone-nav.css">
    <script src="../../../js/standalone-nav.js"></script>
    <script src="../../../js/common.js"></script>
    
    <link rel="stylesheet" href="../../../css/claude.css">

    <style>
        :root {
            --bg-primary: #F9FAFB;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F3F4F6;
            --text-primary: #1A1A1A;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --accent-green: #10B981;
            --accent-blue: #3B82F6;
            --accent-orange: #F59E0B;
            --accent-purple: #8B5CF6;
            --border-light: #E5E7EB;
            --border-medium: #D1D5DB;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            width: 100%;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-light);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-form {
            margin-bottom: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
            font-size: 0.875rem;
        }

        .form-control {
            padding: 8px 12px;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-help {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .config-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s ease-in-out;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #2563EB;
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-medium);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: var(--border-light);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .setup-steps {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .step-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--accent-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-content h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .step-content p {
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: 0.875rem;
        }

        .button-group {
            display: flex;
            gap: 8px;
        }

        .status-message {
            margin-top: 12px;
            padding: 12px;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            display: none;
        }

        .status-message.success {
            background-color: #D1FAE5;
            border: 1px solid #A7F3D0;
            color: #065F46;
        }

        .status-message.error {
            background-color: #FEE2E2;
            border: 1px solid #FECACA;
            color: #991B1B;
        }

        .status-message.info {
            background-color: #DBEAFE;
            border: 1px solid #BFDBFE;
            color: #1E40AF;
        }

        .loading-spinner {
            width: 12px;
            height: 12px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        
        /* Large screens (desktops) */
        @media (min-width: 1201px) {
            .container {
                padding: 0 40px;
            }
        }
        
        /* Medium screens (tablets) */
        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
                margin: 15px auto;
                padding: 0 15px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .card-title {
                font-size: 1.375rem;
            }
        }
        
        /* Small screens (mobile) */
        @media (max-width: 768px) {
            .container {
                margin: 10px auto;
                padding: 0 10px;
            }
            
            .card {
                padding: 16px;
                margin-bottom: 16px;
                border-radius: 8px;
            }
            
            .card-title {
                font-size: 1.25rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .config-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .config-actions .btn {
                width: 100%;
                justify-content: center;
            }
            
            .setup-steps {
                gap: 12px;
            }
            
            .step-item {
                flex-direction: column;
                gap: 12px;
                padding: 12px;
            }
            
            .step-number {
                align-self: flex-start;
            }
            
            .button-group {
                flex-direction: column;
                gap: 8px;
            }
            
            .button-group .btn {
                width: 100%;
                justify-content: center;
            }
            
            .breadcrumb {
                font-size: 0.875rem;
                margin-bottom: 8px;
            }
            
            .breadcrumb[style*="float:right"] {
                float: none !important;
                text-align: left;
                margin-top: 4px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .container {
                padding: 0 8px;
                margin: 8px auto;
            }
            
            .card {
                padding: 12px;
                margin-bottom: 12px;
            }
            
            .card-title {
                font-size: 1.125rem;
            }
            
            .form-control {
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .btn {
                padding: 10px 12px;
                font-size: 0.875rem;
            }
            
            .step-item {
                padding: 8px;
            }
            
            .setup-steps {
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="breadcrumb">
            <a href="../../../admin/">‚Üê Admin Dashboard</a> - <a href="../../../projects/#list=modelteam">Coding Meetup Team</a>
        </div>

        <div class="card">
            <h2 class="card-title">üöÄ Google Cloud Project Setup</h2>
            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                Configure your Google Cloud project for Meetup Integration and <a href="../form">Member Form authentication</a>.
            </p>
            
            <div class="config-form">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Project ID</label>
                        <input type="text" id="project-id" class="form-control" placeholder="e.g., my-meetup-project">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Google Account Email</label>
                        <input type="email" id="user-email" class="form-control" placeholder="your.email@gmail.com">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Organization ID (Optional)</label>
                        <input type="text" id="org-id" class="form-control" placeholder="e.g., 123456789012">
                        <small class="form-help">Leave blank for personal projects</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Billing Account ID (Optional)</label>
                        <input type="text" id="billing-id" class="form-control" placeholder="e.g., 01234A-567890-BCDEF1">
                        <small class="form-help">Required for API-enabled projects</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Service Account Key (JSON)</label>
                    <textarea id="service-key" class="form-control" rows="4" placeholder="Paste your service account JSON key here for automated project creation">
                    </textarea>
                    <small class="form-help">Required for creating projects via API. Should have Cloud Resource Manager Admin role.</small>
                </div>
                <div class="config-actions">
                    <button class="btn btn-secondary" id="load-config" onclick="loadConfiguration()">
                        <i data-feather="refresh-cw"></i>
                        Load from .env
                    </button>
                    <button class="btn btn-primary" id="save-config" onclick="saveConfiguration()">
                        <i data-feather="save"></i>
                        Save to .env
                    </button>
                </div>
                <div id="config-status" class="status-message"></div>
            </div>
            
            <div class="setup-steps">
                <div class="step-item">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Create Google Cloud Project</h4>
                        <p>Create the "[project name]" project in Google Cloud Console or via API</p>
                        <div class="button-group">
                            <button class="btn btn-secondary" id="create-project-manual" onclick="createGoogleProjectManual()">
                                <i data-feather="external-link"></i>
                                Via Google Page
                            </button>
                            <button class="btn btn-primary" id="create-project-api" onclick="createGoogleProjectAPI()">
                                <i data-feather="zap"></i>
                                Create via API
                            </button>
                        </div>
                        <div id="project-status" class="status-message"></div>
                    </div>
                </div>
                
                <div class="step-item">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Enable Required APIs</h4>
                        <p>Enable Google Sheets API and Google Meet API for the project</p>
                        <button class="btn btn-secondary" id="enable-apis" onclick="enableAPIs()" disabled>
                            <i data-feather="settings"></i>
                            Enable APIs
                        </button>
                        <div id="apis-status" class="status-message"></div>
                    </div>
                </div>
                
                <div class="step-item">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Create Service Account</h4>
                        <p>Create service account for automated access to Google services</p>
                        <button class="btn btn-secondary" id="create-service" onclick="createServiceAccount()" disabled>
                            <i data-feather="key"></i>
                            Create Service Account
                        </button>
                        <div id="service-status" class="status-message"></div>
                    </div>
                </div>
                
                <div class="step-item">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Download Credentials</h4>
                        <p>Download JSON credentials file for authentication</p>
                        <button class="btn btn-secondary" id="download-creds" onclick="downloadCredentials()" disabled>
                            <i data-feather="download"></i>
                            Download Credentials
                        </button>
                        <div id="creds-status" class="status-message"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Member Form Configuration -->
        <div class="card">
            <h2 class="card-title">üìù Member Registration Form Config</h2>
            <p style="color: var(--text-secondary); margin-bottom: 16px;">
                Configure the public member registration form settings and appearance. These settings are stored in the public config file and control how the form appears to users.
            </p>
            
            <div class="config-form">
                <!-- Google Sheets Integration -->
                <div class="form-group">
                    <label class="form-label">Google Sheets ID</label>
                    <input type="text" id="sheets-id" class="form-control" placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                    <small class="form-help">The spreadsheet ID from your Google Sheets URL where member data will be stored</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Worksheet Name</label>
                        <input type="text" id="worksheet-name" class="form-control" placeholder="Members" value="Members">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Google OAuth Client ID</label>
                        <input type="text" id="oauth-client-id" class="form-control" placeholder="123456789-abcdef.apps.googleusercontent.com">
                        <small class="form-help">OAuth Client ID for Google sign-in authentication</small>
                    </div>
                </div>

                <!-- Form Appearance -->
                <h3 style="margin: 24px 0 12px 0; color: var(--text-primary);">Form Appearance & Behavior</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Form Title</label>
                        <input type="text" id="form-title" class="form-control" placeholder="Member Registration" value="Member Registration">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Form Subtitle</label>
                        <input type="text" id="form-subtitle" class="form-control" placeholder="Join our community..." value="Join our community of developers and contributors working on sustainable impact projects">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Primary Color</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="color" id="primary-color" value="#3B82F6" style="width: 50px; height: 38px; border: 1px solid var(--border-light); border-radius: 6px;">
                            <input type="text" id="primary-color-text" class="form-control" value="#3B82F6" style="flex: 1;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Accent Color</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="color" id="accent-color" value="#10B981" style="width: 50px; height: 38px; border: 1px solid var(--border-light); border-radius: 6px;">
                            <input type="text" id="accent-color-text" class="form-control" value="#10B981" style="flex: 1;">
                        </div>
                    </div>
                </div>

                <!-- Welcome Messages -->
                <h3 style="margin: 24px 0 12px 0; color: var(--text-primary);">Welcome Messages</h3>
                
                <div class="form-group">
                    <label class="form-label">New Member Welcome</label>
                    <textarea id="welcome-new" class="form-control" rows="3" placeholder="Welcome message for new members...">Welcome to PartnerTools! Please fill out the registration form to join our community of developers working on sustainable impact projects.</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Returning Member Welcome</label>
                    <textarea id="welcome-returning" class="form-control" rows="3" placeholder="Welcome message for returning members...">Welcome back! Your existing information has been loaded. Please review and update any details as needed.</textarea>
                </div>

                <!-- Form Behavior -->
                <h3 style="margin: 24px 0 12px 0; color: var(--text-primary);">Form Behavior</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="allow-duplicates" style="margin-right: 8px;">
                            Allow Duplicate Emails
                        </label>
                        <small class="form-help">If unchecked, will update existing records instead of creating duplicates</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="require-github" checked style="margin-right: 8px;">
                            Require GitHub Username
                        </label>
                        <small class="form-help">Make GitHub username a required field</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="show-progress" checked style="margin-right: 8px;">
                            Show Progress Indicator
                        </label>
                        <small class="form-help">Display completion progress bar</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="enable-preview" checked style="margin-right: 8px;">
                            Enable Data Preview
                        </label>
                        <small class="form-help">Allow users to preview data before submitting</small>
                    </div>
                </div>

                <!-- Links and URLs -->
                <h3 style="margin: 24px 0 12px 0; color: var(--text-primary);">Related Links</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Community Members Page</label>
                        <input type="url" id="members-page-url" class="form-control" placeholder="https://model.earth/community/members" value="https://model.earth/community/members">
                        <small class="form-help">Link to public members listing page</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Projects Page</label>
                        <input type="url" id="projects-page-url" class="form-control" placeholder="https://model.earth/projects" value="https://model.earth/projects">
                        <small class="form-help">Link to projects overview page</small>
                    </div>
                </div>

                <div class="config-actions">
                    <button class="btn btn-secondary" id="load-form-config" onclick="loadFormConfiguration()">
                        <i data-feather="refresh-cw"></i>
                        Load Current Config
                    </button>
                    <button class="btn btn-primary" id="save-form-config" onclick="saveFormConfiguration()">
                        <i data-feather="save"></i>
                        Save Form Config
                    </button>
                    <button class="btn btn-secondary" id="preview-form" onclick="previewForm()">
                        <i data-feather="eye"></i>
                        Preview Form
                    </button>
                </div>
                <div id="form-config-status" class="status-message"></div>
            </div>
        </div>

        <!-- Google Sheets Setup Guide -->
        <div class="card">
            <h2 class="card-title">üìä Google Sheets Setup Guide</h2>
            <div class="setup-guide">
                <div class="step-item">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Create Google Sheet</h4>
                        <p>Create a new Google Sheet with the following column headers in row 1:</p>
                        <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 6px; margin: 8px 0; font-family: monospace; font-size: 13px; overflow-x: auto;">
                            Timestamp | Handle | Name | ToDos | Projects | Team | Focus | UN Goal | School and Degree Program | Your Location | Github | Status | Email | StartDate | EndDate | Note | Your Website | Date Degree Completed | OPT University Department | OPT University Department,Email Phone | HoursPerWeek | Job Title | Phone
                        </div>
                        <button class="btn btn-secondary" onclick="copySheetHeaders()">
                            <i data-feather="copy"></i>
                            Copy Headers
                        </button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Share with Service Account</h4>
                        <p>Share your Google Sheet with the service account email from your JSON key file. Grant "Editor" permissions.</p>
                        <button class="btn btn-secondary" onclick="openGoogleSheets()">
                            <i data-feather="external-link"></i>
                            Open Google Sheets
                        </button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Configure OAuth for Public Access</h4>
                        <p>Set up OAuth 2.0 client in Google Cloud Console for public form authentication.</p>
                        <button class="btn btn-secondary" onclick="openOAuthConfig()">
                            <i data-feather="key"></i>
                            Configure OAuth
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">üìñ Integration Guide & Documentation</h2>
            <div id="readmeDiv" class="readme-content">
                <p style="color: var(--text-secondary); font-style: italic;">
                    Loading integration guide...
                </p>
            </div>
        </div>

        <!-- Quick Links -->
        <div style="margin: 24px 0; text-align: center;">
            <a href="../form/" class="btn btn-primary" style="margin-right: 12px;">
                <i data-feather="users"></i>
                Open Member Registration Form
            </a>
            <a href="../../../projects/#list=modelteam" class="btn btn-secondary">
                <i data-feather="code"></i>
                View Coding Meetup Team
            </a>
        </div>

    </div>

    <script src="https://unpkg.com/feather-icons"></script>
    <script>
        const GEMINI_API_BASE = 'http://localhost:8081/api';

        // Google Project Setup Functions
        let PROJECT_ID = '';
        let USER_EMAIL = '';
        
        // Load configuration from .env file
        async function loadConfiguration() {
            const btn = document.getElementById('load-config');
            const status = document.getElementById('config-status');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Loading...';
            
            try {
                const response = await fetch(`${GEMINI_API_BASE}/config/env`);
                
                // Check if the response is ok before trying to parse JSON
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Server returned ${response.status}: ${errorText || 'Unknown error'}`);
                }
                
                // Get response text first to check if it's valid JSON
                const responseText = await response.text();
                
                // Try to parse JSON, with fallback for empty or invalid responses
                let data;
                try {
                    data = responseText ? JSON.parse(responseText) : {};
                } catch (jsonError) {
                    // If JSON parsing fails, provide the raw response for debugging
                    throw new Error(`Invalid JSON response: ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}`);
                }
                
                // Update form fields if values exist in .env
                if (data.google_project_id) {
                    document.getElementById('project-id').value = data.google_project_id;
                    PROJECT_ID = data.google_project_id;
                    updateProjectNameInText(data.google_project_id);
                }
                
                if (data.google_user_email) {
                    document.getElementById('user-email').value = data.google_user_email;
                    USER_EMAIL = data.google_user_email;
                }
                
                if (data.google_org_id) {
                    document.getElementById('org-id').value = data.google_org_id;
                }
                
                if (data.google_billing_id) {
                    document.getElementById('billing-id').value = data.google_billing_id;
                }
                
                if (data.google_service_key) {
                    document.getElementById('service-key').value = data.google_service_key;
                }
                
                status.className = 'status-message success';
                status.style.display = 'block';
                status.innerHTML = '<i data-feather="check-circle"></i> Configuration loaded from .env file';
                
                // Change button text to indicate reload functionality and mark as successful
                btn.innerHTML = '<i data-feather="refresh-cw"></i> Reload from .env';
                btn.setAttribute('data-loaded', 'true');
                
                // Update feather icons
                if (window.feather) feather.replace();
                
            } catch (error) {
                status.className = 'status-message error';
                status.style.display = 'block';
                let errorMessage = 'Error loading configuration: ';
                if (error.message === 'Failed to fetch') {
                    errorMessage = 'Backend API not available (fetch failed). To view requested data, run locally using the commands on our Admin Page.';
                } else {
                    errorMessage += error.message + '. To view requested data, run locally using the commands on our Admin Page.';
                }
                status.innerHTML = '<span style="color: var(--accent-red);">' + errorMessage + ' <a href="../../../admin" style="color: var(--accent-blue); text-decoration: underline;">Link to: /admin</a></span>';
                
                // Reset button text on error
                btn.innerHTML = '<i data-feather="refresh-cw"></i> Load from .env';
                btn.removeAttribute('data-loaded');
            } finally {
                btn.disabled = false;
                
                // Only reset button text if it wasn't successfully loaded
                if (!btn.hasAttribute('data-loaded')) {
                    btn.innerHTML = '<i data-feather="refresh-cw"></i> Load from .env';
                }
                
                if (window.feather) feather.replace();
            }
        }
        
        // Save configuration to .env file
        async function saveConfiguration() {
            const btn = document.getElementById('save-config');
            const status = document.getElementById('config-status');
            const projectId = document.getElementById('project-id').value.trim();
            const userEmail = document.getElementById('user-email').value.trim();
            
            if (!projectId || !userEmail) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Please fill in both Project ID and Email fields';
                return;
            }
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Saving...';
            
            try {
                const response = await fetch(`${GEMINI_API_BASE}/config/env`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        google_project_id: projectId,
                        google_user_email: userEmail,
                        google_org_id: document.getElementById('org-id').value.trim() || null,
                        google_billing_id: document.getElementById('billing-id').value.trim() || null,
                        google_service_key: document.getElementById('service-key').value.trim() || null
                    })
                });
                
                // Check if the response is ok before trying to parse JSON
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Server returned ${response.status}: ${errorText || 'Unknown error'}`);
                }
                
                // Get response text first to check if it's valid JSON
                const responseText = await response.text();
                
                // Try to parse JSON, with fallback for empty or invalid responses
                let data;
                try {
                    data = responseText ? JSON.parse(responseText) : { success: false, error: 'Empty response from server' };
                } catch (jsonError) {
                    // If JSON parsing fails, provide the raw response for debugging
                    throw new Error(`Invalid JSON response: ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}`);
                }
                
                if (data.success) {
                    // Update global variables
                    PROJECT_ID = projectId;
                    USER_EMAIL = userEmail;
                    
                    status.className = 'status-message success';
                    status.style.display = 'block';
                    status.innerHTML = '<i data-feather="check-circle"></i> Configuration saved to .env file';
                } else {
                    throw new Error(data.error || 'Failed to save configuration');
                }
                
                // Update feather icons
                if (window.feather) feather.replace();
                
            } catch (error) {
                status.className = 'status-message error';
                status.style.display = 'block';
                let errorMessage = 'Error saving configuration: ';
                if (error.message === 'Failed to fetch') {
                    errorMessage = 'Backend API not available (fetch failed). To view requested data, run locally using the commands on our Admin Page.';
                } else {
                    errorMessage += error.message + '. To view requested data, run locally using the commands on our Admin Page.';
                }
                status.innerHTML = '<span style="color: var(--accent-red);">' + errorMessage + ' <a href="../../../admin" style="color: var(--accent-blue); text-decoration: underline;">Link to: /admin</a></span>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="save"></i> Save to .env';
                if (window.feather) feather.replace();
            }
        }
        
        // Update PROJECT_ID and USER_EMAIL when form fields change
        document.getElementById('project-id').addEventListener('input', function() {
            PROJECT_ID = this.value.trim();
            updateProjectNameInText(PROJECT_ID);
        });
        
        document.getElementById('user-email').addEventListener('input', function() {
            USER_EMAIL = this.value.trim();
        });
        
        // Function to update project name in all text content
        function updateProjectNameInText(projectName) {
            const displayName = projectName || '[project name]';
            
            // Find all elements that contain project name references
            const elementsToUpdate = [
                // Status messages and instructions
                ...document.querySelectorAll('.status-message'),
                ...document.querySelectorAll('.step-content p'),
                ...document.querySelectorAll('.step-content h4')
            ];
            
            elementsToUpdate.forEach(element => {
                if (element.innerHTML) {
                    // Replace various patterns of project name references
                    element.innerHTML = element.innerHTML
                        .replace(/\[project id\]/g, displayName);
                }
            });
        }
        
        // Manual project creation via Google Cloud Console
        async function createGoogleProjectManual() {
            const btn = document.getElementById('create-project-manual');
            const status = document.getElementById('project-status');
            
            if (!PROJECT_ID) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Please enter a Project ID first';
                return;
            }
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Opening...';
            
            try {
                // Open Google Cloud Console in new tab for manual project creation
                const projectUrl = `https://console.cloud.google.com/projectcreate?previousPage=%2Fwelcome&project=${PROJECT_ID}`;
                window.open(projectUrl, '_blank');
                
                // Show instructions
                status.className = 'status-message info';
                status.style.display = 'block';
                status.innerHTML = `
                    <strong>Manual Step Required:</strong><br>
                    1. A new tab opened to Google Cloud Console<br>
                    2. Set project name to: <strong>${PROJECT_ID || '[project name]'}</strong><br>
                    3. Use billing account for: <strong>${USER_EMAIL}</strong><br>
                    4. Click "Create" button<br>
                    5. Return here and click "Project Created" when done
                `;
                
                btn.innerHTML = '<i data-feather="check"></i> Project Created';
                btn.onclick = () => confirmProjectCreated();
                
            } catch (error) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Error: ' + error.message;
                
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="external-link"></i> Via Google Page';
            }
        }
        
        // API-based project creation
        async function createGoogleProjectAPI() {
            const btn = document.getElementById('create-project-api');
            const status = document.getElementById('project-status');
            const serviceKey = document.getElementById('service-key').value.trim();
            
            if (!PROJECT_ID) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Please enter a Project ID first';
                return;
            }
            
            if (!serviceKey) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Please provide a Service Account Key for API access';
                return;
            }
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Creating...';
            
            try {
                const response = await fetch(`${GEMINI_API_BASE}/google/create-project`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        project_id: PROJECT_ID,
                        user_email: USER_EMAIL,
                        org_id: document.getElementById('org-id').value.trim() || null,
                        billing_id: document.getElementById('billing-id').value.trim() || null,
                        service_key: serviceKey
                    })
                });
                
                // Check if response is ok first, then parse JSON
                let data;
                if (!response.ok) {
                    const errorText = await response.text();
                    try {
                        data = JSON.parse(errorText);
                    } catch {
                        throw new Error(`Server returned ${response.status}: ${errorText}`);
                    }
                } else {
                    data = await response.json();
                }
                
                if (data.success) {
                    status.className = 'status-message success';
                    status.style.display = 'block';
                    status.innerHTML = `
                        <i data-feather="check-circle"></i> <strong>Project Created Successfully!</strong><br>
                        Project ID: <strong>${PROJECT_ID}</strong><br>
                        ${data.message || 'Ready to proceed to next step.'}
                    `;
                    
                    btn.innerHTML = '<i data-feather="check"></i> Completed';
                    btn.disabled = true;
                    
                    // Enable next step
                    document.getElementById('enable-apis').disabled = false;
                    
                } else {
                    // Throw an error with the full data object for enhanced error handling
                    const error = new Error(data.error || 'Failed to create project');
                    error.responseData = data;
                    throw error;
                }
                
                // Update feather icons
                if (window.feather) feather.replace();
                
            } catch (error) {
                // Check if we have enhanced error data from the API response
                const errorData = error.responseData;
                
                // Display enhanced error message if available
                if (errorData && errorData.help) {
                    status.className = 'status-message info'; // Light blue background
                    status.style.display = 'block';
                    status.innerHTML = `
                        <div style="background: var(--accent-blue); color: white; padding: 8px; border-radius: 4px; margin-bottom: 12px;">
                            <strong>Get your Google Service Account Key</strong>
                        </div>
                        
                        <div style="background: #E3F2FD; border: 1px solid #90CAF9; border-radius: 6px; padding: 12px;">
                            <h4 style="color: #1565C0; margin: 0 0 8px 0;">
                                <i data-feather="info" style="width: 16px; height: 16px;"></i> 
                                ${errorData.help.title}
                            </h4>
                            
                            <p style="margin: 8px 0;"><strong>
                                <a href="${errorData.help.google_console_url}" target="_blank" style="color: var(--accent-blue); text-decoration: underline;">
                                    ‚Üí Open Google Cloud Console
                                </a>
                            </strong></p>
                            
                            <ol style="margin: 8px 0; padding-left: 18px;">
                                ${errorData.help.steps.map(step => {
                                    // Remove the number prefix since <ol> will add its own numbering
                                    const cleanStep = step.replace(/^\d+\.\s*/, '');
                                    return `<li style="margin: 4px 0;">${cleanStep}</li>`;
                                }).join('')}
                            </ol>
                            
                            <div style="background: #F3F4F6; padding: 8px; border-radius: 4px; margin: 8px 0; font-size: 13px;">
                                <strong>JSON Format:</strong> ${errorData.help.json_format_example}
                            </div>
                            
                            <div style="margin-top: 12px; font-size: 14px;">
                                <strong style="color: #1565C0;">Billing Account Info:</strong><br>
                                <span style="color: #2E7D32;">‚úì Required:</span> ${errorData.help.billing_info.required_for}<br>
                                <span style="color: #F57C00;">‚óã Optional:</span> ${errorData.help.billing_info.not_required_for}<br>
                                <em style="color: #424242;">${errorData.help.billing_info.note}</em>
                            </div>
                        </div>
                    `;
                } else {
                    // Fallback to original error display
                    status.className = 'status-message error';
                    status.style.display = 'block';
                    status.innerHTML = `
                        <strong>API Creation Failed:</strong><br>
                        ${error.message}<br><br>
                        <strong>Troubleshooting:</strong><br>
                        ‚Ä¢ Ensure service account has Cloud Resource Manager Admin role<br>
                        ‚Ä¢ Check that the JSON key is valid<br>
                        ‚Ä¢ Verify organization/billing permissions if using those fields
                    `;
                }
                
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="zap"></i> Create via API';
                if (window.feather) feather.replace();
            }
        }
        
        function confirmProjectCreated() {
            const btnManual = document.getElementById('create-project-manual');
            const status = document.getElementById('project-status');
            const enableBtn = document.getElementById('enable-apis');
            
            status.className = 'status-message success';
            status.innerHTML = '<i data-feather="check-circle"></i> Project created successfully!';
            
            btnManual.disabled = true;
            btnManual.innerHTML = '<i data-feather="check"></i> Completed';
            
            // Also disable API button since project is created
            const btnAPI = document.getElementById('create-project-api');
            btnAPI.disabled = true;
            btnAPI.innerHTML = '<i data-feather="check"></i> Completed';
            
            // Enable next step
            enableBtn.disabled = false;
        }
        
        async function enableAPIs() {
            const btn = document.getElementById('enable-apis');
            const status = document.getElementById('apis-status');
            const serviceBtn = document.getElementById('create-service');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Enabling...';
            
            try {
                // Open APIs & Services page
                const apisUrl = `https://console.cloud.google.com/apis/dashboard?project=${PROJECT_ID}`;
                window.open(apisUrl, '_blank');
                
                status.className = 'status-message info';
                status.style.display = 'block';
                status.innerHTML = `
                    <strong>Enable these APIs:</strong><br>
                    1. Google Sheets API<br>
                    2. Google Meet API<br>
                    3. Google Calendar API (optional)<br>
                    <br>Click "APIs Enabled" when complete.
                `;
                
                btn.innerHTML = '<i data-feather="check"></i> APIs Enabled';
                btn.onclick = () => confirmAPIsEnabled();
                
            } catch (error) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Error: ' + error.message;
                
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="settings"></i> Enable APIs';
            }
        }
        
        function confirmAPIsEnabled() {
            const btn = document.getElementById('enable-apis');
            const status = document.getElementById('apis-status');
            const serviceBtn = document.getElementById('create-service');
            
            status.className = 'status-message success';
            status.innerHTML = '<i data-feather="check-circle"></i> APIs enabled successfully!';
            
            btn.disabled = true;
            btn.innerHTML = '<i data-feather="check"></i> Completed';
            
            // Enable next step
            serviceBtn.disabled = false;
        }
        
        async function createServiceAccount() {
            const btn = document.getElementById('create-service');
            const status = document.getElementById('service-status');
            const credsBtn = document.getElementById('download-creds');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Creating...';
            
            try {
                // Open Service Accounts page
                const serviceUrl = `https://console.cloud.google.com/iam-admin/serviceaccounts?project=${PROJECT_ID}`;
                window.open(serviceUrl, '_blank');
                
                status.className = 'status-message info';
                status.style.display = 'block';
                status.innerHTML = `
                    <strong>Create Service Account:</strong><br>
                    1. Click "+ CREATE SERVICE ACCOUNT"<br>
                    2. Name: <strong>${PROJECT_ID || '[project name]'}-service</strong><br>
                    3. Description: <strong>Service account for ${PROJECT_ID || '[project name]'} integration</strong><br>
                    4. Grant "Editor" role<br>
                    5. Click "Service Account Created" when done
                `;
                
                btn.innerHTML = '<i data-feather="check"></i> Service Account Created';
                btn.onclick = () => confirmServiceAccountCreated();
                
            } catch (error) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Error: ' + error.message;
                
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="key"></i> Create Service Account';
            }
        }
        
        function confirmServiceAccountCreated() {
            const btn = document.getElementById('create-service');
            const status = document.getElementById('service-status');
            const credsBtn = document.getElementById('download-creds');
            
            status.className = 'status-message success';
            status.innerHTML = '<i data-feather="check-circle"></i> Service account created successfully!';
            
            btn.disabled = true;
            btn.innerHTML = '<i data-feather="check"></i> Completed';
            
            // Enable next step
            credsBtn.disabled = false;
        }
        
        async function downloadCredentials() {
            const btn = document.getElementById('download-creds');
            const status = document.getElementById('creds-status');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Preparing...';
            
            try {
                // Open Service Accounts page
                const serviceUrl = `https://console.cloud.google.com/iam-admin/serviceaccounts?project=${PROJECT_ID}`;
                window.open(serviceUrl, '_blank');
                
                status.className = 'status-message info';
                status.style.display = 'block';
                status.innerHTML = `
                    <strong>Download Credentials:</strong><br>
                    1. Click on the service account you created<br>
                    2. Go to "Keys" tab<br>
                    3. Click "ADD KEY" ‚Üí "Create new key"<br>
                    4. Select "JSON" format<br>
                    5. Save as <strong>${PROJECT_ID || '[project name]'}-credentials.json</strong><br>
                    6. Click "Credentials Downloaded" when done
                `;
                
                btn.innerHTML = '<i data-feather="check"></i> Credentials Downloaded';
                btn.onclick = () => confirmCredentialsDownloaded();
                
            } catch (error) {
                status.className = 'status-message error';
                status.style.display = 'block';
                status.textContent = 'Error: ' + error.message;
                
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="download"></i> Download Credentials';
            }
        }
        
        function confirmCredentialsDownloaded() {
            const btn = document.getElementById('download-creds');
            const status = document.getElementById('creds-status');
            
            status.className = 'status-message success';
            status.style.display = 'block';
            status.innerHTML = `
                <i data-feather="check-circle"></i> <strong>Setup Complete!</strong><br>
                Your Google project is ready. Store the credentials file securely.<br>
                <strong>Next:</strong> Configure the credentials in your application.
            `;
            
            btn.disabled = true;
            btn.innerHTML = '<i data-feather="check"></i> Completed';
        }

        // ============ MEMBER FORM CONFIGURATION FUNCTIONS ============

        // Load form configuration from public config file
        async function loadFormConfiguration() {
            const btn = document.getElementById('load-form-config');
            const status = document.getElementById('form-config-status');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Loading...';
            
            try {
                const response = await fetch(`${GEMINI_API_BASE}/google/sheets/config`);
                
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }
                
                const configData = await response.json();
                
                if (configData.success && configData.config) {
                    populateFormConfig(configData.config);
                    showFormStatus('success', 'Form configuration loaded successfully');
                } else {
                    showFormStatus('info', 'Using default configuration. Save to create config file.');
                }
                
            } catch (error) {
                console.error('Error loading form configuration:', error);
                showFormStatus('error', `Error loading configuration: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="refresh-cw"></i> Load Current Config';
                feather.replace();
            }
        }

        // Populate form with configuration data
        function populateFormConfig(config) {
            // Google Sheets settings
            if (config.googleSheets) {
                setIfExists('sheets-id', config.googleSheets.spreadsheetId);
                setIfExists('worksheet-name', config.googleSheets.worksheetName);
            }
            
            // OAuth settings
            if (config.oauth) {
                setIfExists('oauth-client-id', config.oauth.clientId);
            }
            
            // Form appearance
            if (config.appearance) {
                setIfExists('form-title', config.appearance.title);
                setIfExists('form-subtitle', config.appearance.subtitle);
                setIfExists('primary-color', config.appearance.primaryColor);
                setIfExists('primary-color-text', config.appearance.primaryColor);
                setIfExists('accent-color', config.appearance.accentColor);
                setIfExists('accent-color-text', config.appearance.accentColor);
            }
            
            // Welcome messages
            if (config.messages) {
                setIfExists('welcome-new', config.messages.welcomeNew);
                setIfExists('welcome-returning', config.messages.welcomeReturning);
            }
            
            // Form behavior
            if (config.behavior) {
                setCheckboxIfExists('allow-duplicates', config.behavior.allowDuplicates);
                setCheckboxIfExists('require-github', config.behavior.requireGithub);
                setCheckboxIfExists('show-progress', config.behavior.showProgress);
                setCheckboxIfExists('enable-preview', config.behavior.enablePreview);
            }
            
            // Links
            if (config.links) {
                setIfExists('members-page-url', config.links.membersPage);
                setIfExists('projects-page-url', config.links.projectsPage);
            }
        }

        // Save form configuration to public config file
        async function saveFormConfiguration() {
            const btn = document.getElementById('save-form-config');
            const status = document.getElementById('form-config-status');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading-spinner" style="display: inline-block;"></span> Saving...';
            
            try {
                const configData = collectFormConfiguration();
                
                const response = await fetch(`${GEMINI_API_BASE}/google/sheets/config`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(configData)
                });
                
                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showFormStatus('success', 'Form configuration saved successfully');
                } else {
                    throw new Error(result.error || 'Failed to save configuration');
                }
                
            } catch (error) {
                console.error('Error saving form configuration:', error);
                showFormStatus('error', `Error saving configuration: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i data-feather="save"></i> Save Form Config';
                feather.replace();
            }
        }

        // Collect form configuration data
        function collectFormConfiguration() {
            return {
                googleSheets: {
                    spreadsheetId: document.getElementById('sheets-id').value.trim(),
                    worksheetName: document.getElementById('worksheet-name').value.trim() || 'Members',
                    headerRow: 1,
                    dataStartRow: 2
                },
                oauth: {
                    clientId: document.getElementById('oauth-client-id').value.trim(),
                    scopes: [
                        "https://www.googleapis.com/auth/spreadsheets",
                        "https://www.googleapis.com/auth/userinfo.profile", 
                        "https://www.googleapis.com/auth/userinfo.email"
                    ]
                },
                appearance: {
                    title: document.getElementById('form-title').value.trim() || 'Member Registration',
                    subtitle: document.getElementById('form-subtitle').value.trim(),
                    primaryColor: document.getElementById('primary-color').value,
                    accentColor: document.getElementById('accent-color').value
                },
                messages: {
                    welcomeNew: document.getElementById('welcome-new').value.trim(),
                    welcomeReturning: document.getElementById('welcome-returning').value.trim()
                },
                behavior: {
                    allowDuplicates: document.getElementById('allow-duplicates').checked,
                    requireGithub: document.getElementById('require-github').checked,
                    showProgress: document.getElementById('show-progress').checked,
                    enablePreview: document.getElementById('enable-preview').checked
                },
                links: {
                    membersPage: document.getElementById('members-page-url').value.trim(),
                    projectsPage: document.getElementById('projects-page-url').value.trim()
                },
                validation: {
                    requiredFields: [
                        "name", "team", "un_goals", "location", "status", 
                        "github", "start_date", "job_title", "email"
                    ],
                    maxNameLength: 100,
                    maxNoteLength: 1000
                }
            };
        }

        // Preview form with current configuration
        function previewForm() {
            const config = collectFormConfiguration();
            const formUrl = '../form/';
            
            // Create a preview URL with configuration parameters
            const params = new URLSearchParams({
                preview: 'true',
                title: config.appearance.title,
                subtitle: config.appearance.subtitle,
                primaryColor: config.appearance.primaryColor,
                accentColor: config.appearance.accentColor
            });
            
            window.open(`${formUrl}?${params.toString()}`, '_blank');
        }

        // Helper functions
        function setIfExists(id, value) {
            const element = document.getElementById(id);
            if (element && value !== undefined && value !== null) {
                element.value = value;
            }
        }

        function setCheckboxIfExists(id, value) {
            const element = document.getElementById(id);
            if (element && value !== undefined && value !== null) {
                element.checked = Boolean(value);
            }
        }

        function showFormStatus(type, message) {
            const status = document.getElementById('form-config-status');
            status.className = `status-message ${type}`;
            status.style.display = 'block';
            status.innerHTML = message;
            
            if (type === 'success') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 5000);
            }
        }

        // Setup guide functions
        function copySheetHeaders() {
            const headers = 'Timestamp\tHandle\tName\tToDos\tProjects\tTeam\tFocus\tUN Goal\tSchool and Degree Program\tYour Location\tGithub\tStatus\tEmail\tStartDate\tEndDate\tNote\tYour Website\tDate Degree Completed\tOPT University Department\tOPT University Department,Email Phone\tHoursPerWeek\tJob Title\tPhone';
            
            navigator.clipboard.writeText(headers).then(() => {
                showFormStatus('success', 'Column headers copied to clipboard! Paste into row 1 of your Google Sheet.');
            }).catch(() => {
                showFormStatus('error', 'Failed to copy headers. Please copy manually from the display above.');
            });
        }

        function openGoogleSheets() {
            window.open('https://sheets.google.com', '_blank');
        }

        function openOAuthConfig() {
            const projectId = document.getElementById('project-id').value.trim();
            const url = projectId 
                ? `https://console.cloud.google.com/apis/credentials?project=${projectId}`
                : 'https://console.cloud.google.com/apis/credentials';
            window.open(url, '_blank');
        }

        // Color picker synchronization
        function setupColorPickers() {
            const primaryColor = document.getElementById('primary-color');
            const primaryColorText = document.getElementById('primary-color-text');
            const accentColor = document.getElementById('accent-color');
            const accentColorText = document.getElementById('accent-color-text');
            
            primaryColor.addEventListener('input', function() {
                primaryColorText.value = this.value;
            });
            
            primaryColorText.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    primaryColor.value = this.value;
                }
            });
            
            accentColor.addEventListener('input', function() {
                accentColorText.value = this.value;
            });
            
            accentColorText.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-Fa-f]{6}$/)) {
                    accentColor.value = this.value;
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize feather icons
            feather.replace();
            
            // Load configurations automatically
            loadConfiguration();
            loadFormConfiguration();
            
            // Setup color picker synchronization
            setupColorPickers();
            
            displayFile("README.md", "readmeDiv", "_parent");
        });
    </script>
</body>
</html>